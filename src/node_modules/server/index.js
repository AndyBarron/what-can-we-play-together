const apiRouter = require('./api-router');
const config = require('./config');
const express = require('express');
const openidRouter = require('./openid-router');
const path = require('path');
const sharedConfig = require('shared/config');

const DIST_PATH = path.resolve('dist');
const INDEX_PATH = path.join(DIST_PATH, 'index.html');

const app = express();
app.use(sharedConfig.API_BASE_URL, apiRouter);
app.use(sharedConfig.OPENID_BASE_URL, openidRouter);
app.use('/', express.static(DIST_PATH));
app.get('*', (req, res) => res.sendFile(INDEX_PATH));

const port = parseInt(config.PORT);
app.listen(port, () => {
  console.info(`App listening on port ${port}`);
});
