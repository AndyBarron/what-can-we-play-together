apiRouter = require './api-router'
config = require './config'
express = require 'express'
openidRouter = require './openid-router'
path = require 'path'
sharedConfig = require 'shared/config'

DIST_PATH = path.resolve 'dist'
INDEX_PATH = path.join DIST_PATH, 'index.html'

app = do express
app.use sharedConfig.API_BASE_URL, apiRouter
app.use sharedConfig.OPENID_BASE_URL, openidRouter
app.use '/', express.static DIST_PATH
app.get '*', (req, res) => res.sendFile INDEX_PATH

port = parseInt config.PORT
app.listen port, => console.info "App listening on port #{port}"
