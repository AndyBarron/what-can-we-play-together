const queryString = require('query-string');
const React = require('react');
const GameListAjax = require('components/GameListAjax');
const Profiles = require('components/Profiles');
const styles = require('./styles/Profile');

module.exports = class Profile extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      userList: [],
    };
  }
  onUserListChange(userList) {
    this.setState({userList});
  }
  render() {
    const id = this.props.match.params.id;
    let userIdString = id;
    const search = queryString.parse(this.props.location.search);
    const selected = Object.create(null);
    if (search.selected) {
      userIdString += ',' + search.selected;
      const ids = search.selected.split(',');
      ids.forEach((id) => {
        selected[id] = true;
      });
    }
    return (
      <div className={styles.page}>
        <div className={styles.profiles}>
          <Profiles
            name={id}
            location={this.props.location}
            onListChange={(list) => this.onUserListChange(list)}
            selected={selected}
          />
        </div>
        <div className={styles.games}>
          {
            this.state.userList.length ? (
              <section>
                <GameListAjax userIdString={userIdString} />
              </section>
            ) : null
          }
        </div>
      </div>
    );
  }
}
